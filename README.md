# Calculator_core

`calc_core` — это модуль прикладной логики консольного калькулятора.  
Он отвечает за управление жизненным циклом приложения: парсинг аргументов командной строки, проверку входных данных, выполнение вычислений и вывод результата.

Модуль не содержит математической логики — все арифметические операции вынесены в отдельную библиотеку `operations`.

---

## Назначение модуля

`calc_core` реализует следующую архитектуру приложения:

```dir
main
└── run
├── parseArgs
├── checkArgs
├── calculate
└── printResult
```

Такое разделение упрощает поддержку кода, тестирование и повторное использование логики.

---

## Основные сущности

### `CalcContext`

Структура `CalcContext` используется для обмена данными между этапами выполнения программы.

В ней хранятся:
- входные данные (аргументы командной строки),
- выбранная операция,
- статус выполнения,
- результат вычислений.

```cpp
struct CalcContext {
    int64_t a;
    int64_t b;
    bool has_a;
    bool has_b;

    OpKind op;
    OperationalStatus status;

    int64_t  result_i64;
    uint64_t result_u64;
    bool result_is_u64;
};
```

## Основные функции
### `run`

```cpp
int run(int argc, char* const argv[]);
```

Точка входа модуля. Управляет полным циклом работы приложения:
1. парсинг аргументов,
2. валидация входных данных,
3. выполнение вычислений,
4. вывод результата.

---

### `parseArgs`

```cpp
bool parseArgs(int argc, char* const argv[], CalcContext& ctx);
```

Извлекает аргументы командной строки с использованием `getopt_long`
и заполняет структуру `CalcContext`.

При ошибке устанавливает соответствующий статус.

---

### `checkArgs`

bool checkArgs(CalcContext& ctx);

Проверяет корректность входных данных:

- наличие обязательных аргументов,
- допустимость операции,
- деление на ноль,
- отрицательные аргументы для факториала и степени.

---

### `calculate`

```cpp
bool calculate(CalcContext& ctx);
```

Вызывает соответствующую математическую функцию из библиотеки operations.

Все арифметические ошибки (переполнение, деление на ноль и т.д.)
обрабатываются через статус OperationalStatus.

---

### `printResult`

```cpp
void printResult(const CalcContext& ctx);
```

Выводит результат вычисления или сообщение об ошибке в стандартный поток вывода.

---

## Обработка ошибок

Модуль не завершает программу аварийно (exit, abort не используются).
Все ошибки передаются через поле OperationalStatus в CalcContext.

## Зависимости

- Библиотека operations (подключается через CMake FetchContent)

## Пример использования

```bash
./calc -a 2 -b 3 -o +
./calc -a 5 -o fact
```

    явное управление ошибками,

    разделение ответственности между компонентами.
